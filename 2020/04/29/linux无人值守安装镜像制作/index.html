<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yiuterran.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.3.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="这里需要批量安装的是centos 7服务器版，首先下载centos 7最新版，带上GUI的镜像，装在虚拟机里面。然后下载centos 7 minimal镜像用作批量安装的母盘。 注意：不要装centos 8，这货特别大，而且没有图形化配置工具。 概述不同发行版支持的自动安装镜像技术不太一样，红帽这一系的主要使用kickstart，debian则使用preseed。这里安装的是centos7，所以用">
<meta property="og:type" content="article">
<meta property="og:title" content="linux无人值守安装镜像制作.md">
<meta property="og:url" content="http://yiuterran.github.io/2020/04/29/linux%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/index.html">
<meta property="og:site_name" content="无心呢喃">
<meta property="og:description" content="这里需要批量安装的是centos 7服务器版，首先下载centos 7最新版，带上GUI的镜像，装在虚拟机里面。然后下载centos 7 minimal镜像用作批量安装的母盘。 注意：不要装centos 8，这货特别大，而且没有图形化配置工具。 概述不同发行版支持的自动安装镜像技术不太一样，红帽这一系的主要使用kickstart，debian则使用preseed。这里安装的是centos7，所以用">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-04-29T06:29:20.000Z">
<meta property="article:modified_time" content="2020-05-20T02:05:30.358Z">
<meta property="article:author" content="tryao">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="devops">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yiuterran.github.io/2020/04/29/linux%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>linux无人值守安装镜像制作.md | 无心呢喃</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="无心呢喃" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">无心呢喃</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">个人技术类文章博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kickstart%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">kickstart配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">其他配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90iso%E6%96%87%E4%BB%B6"><span class="nav-number">3.1.</span> <span class="nav-text">生成iso文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC"><span class="nav-number">3.2.</span> <span class="nav-text">自动配置脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1"><span class="nav-number">4.</span> <span class="nav-text">无线网卡</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">tryao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">62</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/YiuTerran" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;YiuTerran" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yaotairan@gmail.com" title="E-Mail → mailto:yaotairan@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yiuterran.github.io/2020/04/29/linux%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tryao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心呢喃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          linux无人值守安装镜像制作.md
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-29 14:29:20" itemprop="dateCreated datePublished" datetime="2020-04-29T14:29:20+08:00">2020-04-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-05-20 10:05:30" itemprop="dateModified" datetime="2020-05-20T10:05:30+08:00">2020-05-20</time>
      </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/04/29/linux%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/04/29/linux无人值守安装镜像制作/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>这里需要批量安装的是centos 7服务器版，首先下载centos 7最新版，带上GUI的镜像，装在虚拟机里面。然后下载centos 7 minimal镜像用作批量安装的母盘。</p>
<p>注意：不要装centos 8，这货特别大，而且没有图形化配置工具。</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>不同发行版支持的自动安装镜像技术不太一样，红帽这一系的主要使用kickstart，debian则使用<code>preseed</code>。这里安装的是centos7，所以用的主要是kickstart技术。</p>
<h2 id="kickstart配置"><a href="#kickstart配置" class="headerlink" title="kickstart配置"></a>kickstart配置</h2><p>首先使用yum安装图形化工具<code>system-config-kickstart</code>，对语法熟悉的也可以不用这玩意儿直接撸。</p>
<p>把镜像挂在到centos里，然后<code>cp -r</code>(需要包含隐藏文件）光盘里面的所有的内容到某个路径，比如<code>/root/iso/</code>。在<code>/root/iso</code>下建立文件夹存放kickstart配置文件，比如<code>/root/iso/kickstart/ks.cfg</code>。</p>
<p>打开图形化配置工具kickstart，根据个人需求进行配置。具体可以参考<a target="_blank" rel="noopener" href="https://pdf.us/2018/08/13/1710.html">这里的介绍</a>。最后保存为刚才路径下的文件即可。</p>
<p>网络和个人帐户无需配置，因为可以离线安装。如果自己想装的额外的rpm包，使用<code>repotrack</code>工具下载到<code>Packages</code>文件夹里，在ks的<code>packages</code>部分中加入即可。</p>
<p>最后生成的ks文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#platform&#x3D;x86, AMD64, 或 Intel EM64T</span><br><span class="line">#version&#x3D;DEVEL</span><br><span class="line"># Install OS instead of upgrade</span><br><span class="line">install</span><br><span class="line"># Keyboard layouts</span><br><span class="line">keyboard &#39;us&#39;</span><br><span class="line"># Root password</span><br><span class="line">rootpw --iscrypted $1$0Rnj3JYy$.O6bjrhyiBucwxVpIg8eF1</span><br><span class="line"># System language</span><br><span class="line">lang en_US</span><br><span class="line"># System authorization information</span><br><span class="line">auth  --useshadow  --passalgo&#x3D;sha512</span><br><span class="line"># Use CDROM installation media</span><br><span class="line">cdrom</span><br><span class="line"># Use text mode install</span><br><span class="line">text</span><br><span class="line"># SELinux configuration</span><br><span class="line">selinux --disabled</span><br><span class="line"># Do not configure the X Window System</span><br><span class="line">skipx</span><br><span class="line"></span><br><span class="line"># System bootloader configuration</span><br><span class="line">bootloader --location&#x3D;mbr</span><br><span class="line"></span><br><span class="line"># Firewall configuration</span><br><span class="line">firewall --disabled</span><br><span class="line">services --disabled&#x3D;&quot;chronyd&quot;</span><br><span class="line">services --enabled&#x3D;&quot;sshd&quot;</span><br><span class="line"># System timezone</span><br><span class="line">timezone Asia&#x2F;Shanghai</span><br><span class="line"># Clear the Master Boot Record</span><br><span class="line">zerombr</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all --initlabel</span><br><span class="line"># Disk partitioning information</span><br><span class="line">part &#x2F;boot --fstype&#x3D;&quot;xfs&quot; --size&#x3D;500</span><br><span class="line">part &#x2F;boot&#x2F;efi --fstype&#x3D;&quot;xfs&quot; --size&#x3D;500</span><br><span class="line">part swap --fstype&#x3D;&quot;swap&quot; --size&#x3D;1024</span><br><span class="line">part &#x2F; --fstype&#x3D;&quot;ext4&quot; --grow --size&#x3D;1</span><br><span class="line">poweroff</span><br><span class="line"></span><br><span class="line">%packages --multilib --ignoremissing</span><br><span class="line">lrzsz</span><br><span class="line">net-tools</span><br><span class="line">openssl</span><br><span class="line">python3</span><br><span class="line">screen</span><br><span class="line">tcpdump</span><br><span class="line">zip</span><br><span class="line">unzip</span><br><span class="line">vim-enhanced</span><br><span class="line">wget</span><br><span class="line">yum-utils</span><br><span class="line">nano</span><br><span class="line">NetworkManager-tui</span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%addon com_redhat_kdump --enable --reserve-mb&#x3D;&#39;auto&#39;</span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%post --nochroot</span><br><span class="line">cp -fr &#x2F;mnt&#x2F;install&#x2F;repo&#x2F;plus&#x2F;* &#x2F;mnt&#x2F;sysimage&#x2F;root&#x2F;</span><br><span class="line">echo &quot;&#x2F;bin&#x2F;bash &#x2F;root&#x2F;init.sh&quot; &gt;&gt; &#x2F;mnt&#x2F;sysimage&#x2F;etc&#x2F;rc.local</span><br><span class="line">chmod a+x &#x2F;mnt&#x2F;sysimage&#x2F;etc&#x2F;rc.local</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<h2 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h2><p><strong>每次</strong>修改packages里面的安装条目，需要重新生成repo数据库，语法是在镜像根目录执行<code>createrepo -g repodata/xxxx-c7-minimal-x86_64-comps.xml .</code>，文件的名字可能是一串随机字符，根据个人情况生成。</p>
<p>下面是修改isolinux.cfg保证使用kickstart文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">default vesamenu.c32</span><br><span class="line">timeout 50</span><br><span class="line"></span><br><span class="line">#省略一部分</span><br><span class="line"></span><br><span class="line">label linux</span><br><span class="line">  menu label ^Auto Install CentOS 7</span><br><span class="line">  menu default</span><br><span class="line">  kernel vmlinuz</span><br><span class="line">  append initrd&#x3D;initrd.img inst.stage2&#x3D;hd:LABEL&#x3D;CENTOS7 inst.ks&#x3D;hd:LABEL&#x3D;CENTOS7:&#x2F;kickstart&#x2F;ks.cfg quiet</span><br><span class="line"></span><br><span class="line"># 省略一部分</span><br><span class="line"></span><br><span class="line">menu end</span><br></pre></td></tr></table></figure>

<p>注意这里通过label指定ks文件的路径，防止U盘安装的时候找不到路径。卷标名在生成iso文件的时候可以修改，尽量不要用空格。</p>
<p>同样在<code>EFI/BOOT/grub.cfg</code>里面增加一个入口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">menuentry &#39;Auto Install CentOS 7&#39; --class fedora --class gnu-linux --class gnu --class os &#123;</span><br><span class="line">       linuxefi &#x2F;images&#x2F;pxeboot&#x2F;vmlinuz inst.stage2&#x3D;hd:LABEL&#x3D;CENTOS7 inst.ks&#x3D;hd:LABEL&#x3D;CENTOS7:&#x2F;kickstart&#x2F;ks.cfg quiet</span><br><span class="line">       initrdefi &#x2F;images&#x2F;pxeboot&#x2F;initrd.img</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生成iso文件"><a href="#生成iso文件" class="headerlink" title="生成iso文件"></a>生成iso文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/iso &amp;&amp; mkisofs -v -cache-inodes -joliet-long -R -J -T -V CENTOS7 -o /root/centos7.iso -c isolinux/boot.cat -b isolinux/isolinux.bin -no-emul-boot -boot-load-size 4 -boot-info-table -eltorito-alt-boot -e images/efiboot.img -no-emul-boot .</span><br><span class="line">isohybrid /root/centos7.iso</span><br><span class="line">implantisomd5 /root/centos7.iso</span><br></pre></td></tr></table></figure>

<p>上面是一个简单的脚本用来生成iso文件，注意这里使用-V改了卷标，和上面的hd:label保持一致。最后的alt-boot是efi启动支持。</p>
<p>最后使用dd刻盘到u盘，就可以安装了。</p>
<h3 id="自动配置脚本"><a href="#自动配置脚本" class="headerlink" title="自动配置脚本"></a>自动配置脚本</h3><p>注意到ks文件的post段里面，创建了一个一次性自运行的服务。在镜像根目录下创建<code>plus</code>文件夹，把想要复制到系统的文件都拷贝进去。<code>cp -fr /mnt/install/repo/plus/* /mnt/sysimage/root/</code>这句会将所有的文件拷贝到<code>/root/</code>目录下。</p>
<p>其中<code>init.sh</code>的内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># wait other service start</span></span><br><span class="line">sleep 5</span><br><span class="line"><span class="comment"># iot-device</span></span><br><span class="line">mv /root/cron /etc/cron.d/iot-device</span><br><span class="line"><span class="comment"># params</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ClientAliveInterval 30&quot;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ClientAliveCountMax 86400&quot;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* - noproc 11000&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;root soft nofile 1048576&quot;</span> &gt;&gt;  /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;root hard nofile 1048576&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* hard nofile 1048576&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* soft nofile 1048576&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;fs.file-max = 1048576&quot;</span> &gt;&gt;  /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.core.somaxconn=32768&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;DefaultLimitNOFILE=1048576&quot;</span> &gt;&gt; /etc/systemd/system.conf</span><br><span class="line">sysctl -p</span><br><span class="line">sysctl -w net.core.somaxconn=32768</span><br><span class="line">sysctl -w net.ipv4.tcp_max_syn_backlog=16384</span><br><span class="line">sysctl -w net.core.netdev_max_backlog=16384</span><br><span class="line">sysctl -w net.ipv4.ip_local_port_range=<span class="string">&#x27;1000 65535&#x27;</span></span><br><span class="line">sysctl -w net.core.rmem_default=262144</span><br><span class="line">sysctl -w net.core.wmem_default=262144</span><br><span class="line">sysctl -w net.core.rmem_max=16777216</span><br><span class="line">sysctl -w net.core.wmem_max=16777216</span><br><span class="line">sysctl -w net.core.optmem_max=16777216</span><br><span class="line"></span><br><span class="line">sysctl -w net.ipv4.tcp_rmem=<span class="string">&#x27;1024 4096 16777216&#x27;</span></span><br><span class="line">sysctl -w net.ipv4.tcp_wmem=<span class="string">&#x27;1024 4096 16777216&#x27;</span></span><br><span class="line">sysctl -w net.ipv4.tcp_max_tw_buckets=1048576</span><br><span class="line">sysctl -w net.ipv4.tcp_fin_timeout=15</span><br><span class="line">sed -i <span class="string">&#x27;/.*init.*/d&#x27;</span> /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空在安装阶段从光盘安装的所有文件</span></span><br><span class="line">rm -fr /mnt/*</span><br><span class="line">rm /root/*.cfg</span><br><span class="line">rm /root/TRAN*</span><br><span class="line">rm <span class="variable">$0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#主动启动网卡</span></span><br><span class="line">interface=$(ls /sys/class/net| grep -v <span class="string">&quot;lo&quot;</span> | head -1)</span><br><span class="line">ifup <span class="variable">$interface</span></span><br><span class="line"><span class="keyword">if</span> [$? -ne 0];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;can&#x27;t start network, please run nmtui to connect Wi-Fi&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#获取当前网络信息</span></span><br><span class="line">default_route=$(ip route show)</span><br><span class="line">default_interface=$(<span class="built_in">echo</span> <span class="variable">$default_route</span> | sed -e <span class="string">&#x27;s/^.*dev \([^ ]*\).*$/\1/&#x27;</span> | head -n 1)</span><br><span class="line">address=$(ip addr show label <span class="variable">$default_interface</span> scope global | awk <span class="string">&#x27;$1 == &quot;inet&quot; &#123; print $2,$4&#125;&#x27;</span>)</span><br><span class="line">ip=$(<span class="built_in">echo</span> <span class="variable">$address</span> | awk <span class="string">&#x27;&#123;print $1 &#125;&#x27;</span>)</span><br><span class="line">ip=<span class="variable">$&#123;ip%%/*&#125;</span></span><br><span class="line">mask=$(route -n |grep <span class="string">&#x27;U[ \t]&#x27;</span> | head -n 1 | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">gateway=$(route -n | grep <span class="string">&#x27;UG[ \t]&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">dns=$(cat /etc/resolv.conf | grep nameserver | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断default_interface是否为空</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$default_interface</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    default_interface=<span class="variable">$interface</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示网络信息</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;The current net info [dynamic]&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot; device: <span class="variable">$default_interface</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot; ipaddr: <span class="variable">$ip</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;netmask: <span class="variable">$mask</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;gateway: <span class="variable">$gateway</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;    dns: <span class="variable">$dns</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># set last ip to 200</span></span><br><span class="line">IFS=<span class="string">&#x27;.&#x27;</span> <span class="built_in">read</span> -r -a array &lt;&lt;&lt; <span class="string">&quot;<span class="variable">$ip</span>&quot;</span></span><br><span class="line">array[3]=200</span><br><span class="line">newip=$(IFS=. <span class="built_in">eval</span> <span class="string">&#x27;echo &quot;$&#123;array[*]&#125;&quot;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;newip is <span class="variable">$newip</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#网络配置</span></span><br><span class="line">cp /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span> /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span>.bak</span><br><span class="line">uuid=$(cat /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span> |grep UUID|sed -e <span class="string">&#x27;s/&quot;//g&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IPV6INIT=yes&quot;</span>               &gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IPV6_AUTOCONF=yes&quot;</span>         &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;BOOTPROTO=none&quot;</span>            &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;DEVICE=<span class="variable">$default_interface</span>&quot;</span> &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ONBOOT=yes&quot;</span>                &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$uuid</span>&quot;</span>                     &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;TYPE=Ethernet&quot;</span>             &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PROXY_METHOD=none&quot;</span>         &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;BROWSER_ONLY=no&quot;</span>           &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IPADDR=<span class="variable">$newip</span>&quot;</span>             &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;NETMASK=<span class="variable">$mask</span>&quot;</span>             &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GATEWAY=<span class="variable">$gateway</span>&quot;</span>          &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;DNS1=114.114.114.114&quot;</span>      &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;DEFROUTE=yes&quot;</span>              &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IPV4_FAILURE_FATAL=no&quot;</span>     &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IPV6_DEFROUTE=yes&quot;</span>         &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IPV6_FAILURE_FATAL=no&quot;</span>     &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$default_interface</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#DNS配置</span></span><br><span class="line">cp /etc/resolv.conf /etc/resolv.conf.bak</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;# Generated by NetworkManager&quot;</span> &gt; /etc/resolv.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nameserver 114.114.114.114&quot;</span> &gt;&gt; /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启一下网络 使配置生效</span></span><br><span class="line">systemctl restart network</span><br><span class="line">sleep 5</span><br><span class="line">ping -c 4 www.baidu.com</span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;Error! Cant link to Internet&quot;</span></span><br><span class="line">     <span class="comment">#break</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>简单来说，根据dhcp自动配置的ip地址，将其最后一位换成200，改成静态ip写死。如果怕ip地址冲突，直接将获得的ip写成静态ip也可以。<br>然后是一些常见服务器参数的改写，最后是禁止并删除掉一次性脚本的自启动，然后删除掉自身。</p>
<p>如果需要做一些服务相关配置，在这里也可以初始化，比如配置cron定期检查更新。</p>
<p>上面ks文件设置了安装完毕后自动关机，在合适的环境下插上网线开机，就会自动运行上面的初始化脚本，安装好服务。</p>
<h2 id="无线网卡"><a href="#无线网卡" class="headerlink" title="无线网卡"></a>无线网卡</h2><p>如果不是插网线，而是用无线网卡，这里的逻辑就比较复杂，必须让用户手动设置Wi-Fi。然后再手动运行脚本设置为静态ip。</p>
<p>在Package里面增加<code>NetworkManager-tui</code>这个包，init.sh里面判断如果ifup失败，就直接退出。</p>
<p>此时需要用户运行<code>nmtui</code>设置好Wi-Fi（注意Wi-Fi的ssid应为英文，不然显示是乱码）。然后运行如下脚本来将Wi-Fi设置成静态ip：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取当前网络信息</span></span><br><span class="line">default_route=$(ip route show)</span><br><span class="line">default_interface=$(<span class="built_in">echo</span> <span class="variable">$default_route</span> | sed -e <span class="string">&#x27;s/^.*dev \([^ ]*\).*$/\1/&#x27;</span> | head -n 1)</span><br><span class="line">address=$(ip addr show label <span class="variable">$default_interface</span> scope global | awk <span class="string">&#x27;$1 == &quot;inet&quot; &#123; print $2,$4&#125;&#x27;</span>)</span><br><span class="line">ip=$(<span class="built_in">echo</span> <span class="variable">$address</span> | awk <span class="string">&#x27;&#123;print $1 &#125;&#x27;</span>)</span><br><span class="line">ip=<span class="variable">$&#123;ip%%/*&#125;</span></span><br><span class="line">mask=$(route -n |grep <span class="string">&#x27;U[ \t]&#x27;</span> | head -n 1 | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">gateway=$(route -n | grep <span class="string">&#x27;UG[ \t]&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">dns=$(cat /etc/resolv.conf | grep nameserver | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断default_interface是否为空</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$default_interface</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;no working network, exit! if you want to use Wi-Fi, please run nmtui to set&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">cfg_name=$(<span class="built_in">cd</span> /etc/sysconfig/network-scripts &amp;&amp; grep -l Wireless *|grep ifcfg)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;config file is <span class="variable">$cfg_name</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#download iot-device</span></span><br><span class="line">/bin/python3 /root/cron_update.py</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示网络信息</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;The current net info [dynamic]&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot; device: <span class="variable">$default_interface</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot; ipaddr: <span class="variable">$ip</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;netmask: <span class="variable">$mask</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;gateway: <span class="variable">$gateway</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;    dns: <span class="variable">$dns</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># set last ip to 200</span></span><br><span class="line">IFS=<span class="string">&#x27;.&#x27;</span> <span class="built_in">read</span> -r -a array &lt;&lt;&lt; <span class="string">&quot;<span class="variable">$ip</span>&quot;</span></span><br><span class="line">array[3]=200</span><br><span class="line">newip=$(IFS=. <span class="built_in">eval</span> <span class="string">&#x27;echo &quot;$&#123;array[*]&#125;&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#网络配置</span></span><br><span class="line">cp /etc/sysconfig/network-scripts/<span class="variable">$cfg_name</span> /etc/sysconfig/network-scripts/<span class="variable">$cfg_name</span>.bak</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&quot;/.*dhcp.*/d&quot;</span> /etc/sysconfig/network-scripts/<span class="variable">$cfg_name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IPADDR=<span class="variable">$newip</span>&quot;</span>             &gt;&gt; /etc/sysconfig/network-scripts/<span class="variable">$cfg_name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;NETMASK=<span class="variable">$mask</span>&quot;</span>             &gt;&gt; /etc/sysconfig/network-scripts/<span class="variable">$cfg_name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GATEWAY=<span class="variable">$gateway</span>&quot;</span>          &gt;&gt; /etc/sysconfig/network-scripts/<span class="variable">$cfg_name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;DNS1=114.114.114.114&quot;</span>      &gt;&gt; /etc/sysconfig/network-scripts/<span class="variable">$cfg_name</span></span><br><span class="line"></span><br><span class="line">ifdown <span class="variable">$cfg_name</span> &amp;&amp; ifup <span class="variable">$cfg_name</span></span><br><span class="line">sleep 5</span><br><span class="line">ping -c 4 www.baidu.com</span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;Error! Cant link to Internet&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;current ip is <span class="variable">$newip</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>这里仍然是直接设置成200，实际使用的时候可以根据情况编辑。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"># linux</a>
              <a href="/tags/devops/" rel="tag"># devops</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/02/18/mybatis%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%9A%E4%B8%BE/" rel="prev" title="mybatis-plus自定义枚举">
                  <i class="fa fa-chevron-left"></i> mybatis-plus自定义枚举
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/05/21/Workflow%E5%85%A5%E9%97%A8/" rel="next" title="Workflow入门.md">
                  Workflow入门.md <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tryao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://yiuterran.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://yiuterran.github.io/2020/04/29/linux%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/";
    this.page.identifier = "2020/04/29/linux无人值守安装镜像制作/";
    this.page.title = "linux无人值守安装镜像制作.md";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://yiuterran.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
